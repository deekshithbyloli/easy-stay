(()=>{var e={};e.id=741,e.ids=[741],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},5511:e=>{"use strict";e.exports=require("crypto")},9021:e=>{"use strict";e.exports=require("fs")},1645:e=>{"use strict";e.exports=require("net")},1820:e=>{"use strict";e.exports=require("os")},3873:e=>{"use strict";e.exports=require("path")},4998:e=>{"use strict";e.exports=require("perf_hooks")},7910:e=>{"use strict";e.exports=require("stream")},4631:e=>{"use strict";e.exports=require("tls")},9562:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>g,routeModule:()=>y,serverHooks:()=>x,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>N});var r={};s.r(r),s.d(r,{DELETE:()=>h,GET:()=>p,POST:()=>c,PUT:()=>m});var o=s(2706),n=s(8203),a=s(5994),i=s(9187),l=s(3345),u=s(8474),d=s(7579);async function c(e){try{let{hostId:t,name:s,description:r,photos:o,location:n,pricePerNight:a,amenities:c,availability:p}=await e.json();if(!t||!s||!a||!n||!p)return i.NextResponse.json({error:"Required fields are missing"},{status:400});let m=await l.db.select().from(u.GS).where((0,d.eq)(u.GS.id,t)).limit(1).execute();if(!m||0===m.length)return i.NextResponse.json({error:"Host not found"},{status:404});let[h]=await l.db.insert(u.mO).values({hostId:t,name:s,description:r,photos:o||[],location:n,pricePerNight:a,amenities:c||[],rating:0,availability:p}).returning();return i.NextResponse.json({message:"Homestay added successfully",homestay:h},{status:201})}catch(e){return console.error("Error adding homestay:",e),i.NextResponse.json({error:"Failed to add homestay"},{status:500})}}async function p(e){try{let t=e.nextUrl.searchParams.get("hostId");if(console.log("Received hostId:",t),!t)return console.error("Host ID is missing in the request."),i.NextResponse.json({error:"Host ID is required"},{status:400});let s=Number(t);if(isNaN(s))return console.error(`Invalid hostId provided: ${t}`),i.NextResponse.json({error:"Invalid host ID"},{status:400});console.log(`Querying homestays for hostId: ${s}`);let r=await l.db.select().from(u.mO).where((0,d.eq)(u.mO.hostId,s)).execute();if(0===r.length)return console.log(`No homestays found for hostId: ${s}`),i.NextResponse.json({message:"No homestays found for this host"},{status:404});return console.log(`Found ${r.length} homestays for hostId: ${s}`),i.NextResponse.json(r,{status:200})}catch(e){return console.error("Error retrieving homestays:",e),i.NextResponse.json({error:"Failed to retrieve homestay details"},{status:500})}}async function m(e){try{let{id:t,name:s,description:r,photos:o,location:n,pricePerNight:a,amenities:c,availability:p}=await e.json();if(!t||!s||!a||!n||!p)return i.NextResponse.json({error:"Required fields are missing"},{status:400});let m=await l.db.select().from(u.mO).where((0,d.eq)(u.mO.id,t)).limit(1).execute();if(!m||0===m.length)return i.NextResponse.json({error:"Homestay not found"},{status:404});let[h]=await l.db.update(u.mO).set({name:s,description:r||m[0].description,photos:o||m[0].photos,location:n||m[0].location,pricePerNight:a,amenities:c||m[0].amenities,availability:p}).where((0,d.eq)(u.mO.id,t)).returning();return i.NextResponse.json({message:"Homestay updated successfully",homestay:h},{status:200})}catch(e){return console.error("Error updating homestay:",e),i.NextResponse.json({error:"Failed to update homestay"},{status:500})}}async function h(e){try{let t=e.nextUrl.searchParams.get("id");if(console.log("Received homestay ID:",t),!t)return console.error("No homestay ID provided"),i.NextResponse.json({error:"Homestay ID is required"},{status:400});let s=Number(t);if(isNaN(s))return console.error("Invalid homestay ID:",t),i.NextResponse.json({error:"Invalid homestay ID"},{status:400});let r=await l.db.select().from(u.mO).where((0,d.eq)(u.mO.id,s)).limit(1).execute();if(console.log("Homestay found:",r),!r||0===r.length)return console.error(`Homestay with ID ${s} not found`),i.NextResponse.json({error:"Homestay not found"},{status:404});let o=await l.db.delete(u.mO).where((0,d.eq)(u.mO.id,s)).execute();if(console.log("Deletion result:",o),o)return console.log("Homestay deleted successfully"),i.NextResponse.json({message:"Homestay deleted successfully"},{status:200});return console.error("Deletion failed, no rows affected"),i.NextResponse.json({error:"Failed to delete homestay"},{status:500})}catch(e){return console.error("Error deleting homestay:",e),i.NextResponse.json({error:"Failed to delete homestay"},{status:500})}}let y=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/property/route",pathname:"/api/property",filename:"route",bundlePath:"app/api/property/route"},resolvedPagePath:"/Users/deekshithmac/Desktop/home-stay/easy-stay/src/app/api/property/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:f,workUnitAsyncStorage:N,serverHooks:x}=y;function g(){return(0,a.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:N})}},6487:()=>{},8335:()=>{},3345:(e,t,s)=>{"use strict";s.d(t,{db:()=>i});var r=s(5482),o=s(6675),n=s(3186);(0,r.config)({path:".env"});let a=(0,n.A)(process.env.DATABASE_URL),i=(0,o.f)({client:a})},8474:(e,t,s)=>{"use strict";s.d(t,{GS:()=>d,Vy:()=>u,mO:()=>c});var r=s(7328),o=s(9516),n=s(4799),a=s(2590),i=s(9848),l=s(7102);let u=(0,r.cJ)("users_table",{id:(0,o.vX)("id").primaryKey(),name:(0,n.Qq)("name").notNull(),username:(0,n.Qq)("username").notNull().unique(),email:(0,n.Qq)("email").notNull().unique(),password:(0,n.Qq)("password").notNull(),role:(0,n.Qq)("role").notNull().default("user"),createdAt:(0,a.vE)("created_at").notNull().defaultNow()}),d=(0,r.cJ)("hosts_table",{id:(0,o.vX)("id").primaryKey(),userId:(0,i.nd)("user_id").notNull().references(()=>u.id,{onDelete:"cascade"}),propertyIds:(0,l.Fx)("property_ids").notNull().default([])}),c=(0,r.cJ)("homestays_table",{id:(0,o.vX)("id").primaryKey(),hostId:(0,i.nd)("host_id").notNull().references(()=>d.id,{onDelete:"cascade"}),name:(0,n.Qq)("name").notNull(),description:(0,n.Qq)("description"),photos:(0,l.Fx)("photos").notNull().default([]),location:(0,l.Fx)("location").notNull(),pricePerNight:(0,i.nd)("price_per_night").notNull(),amenities:(0,l.Fx)("amenities").notNull().default([]),rating:(0,i.nd)("rating").default(0),availability:(0,l.Fx)("availability").notNull(),createdAt:(0,a.vE)("created_at").notNull().defaultNow(),updatedAt:(0,a.vE)("updated_at").notNull().$onUpdate(()=>new Date)});(0,r.cJ)("bookings_table",{id:(0,o.vX)("id").primaryKey(),userId:(0,i.nd)("user_id").notNull().references(()=>u.id,{onDelete:"cascade"}),homestayId:(0,i.nd)("homestay_id").notNull().references(()=>c.id,{onDelete:"cascade"}),checkIn:(0,a.vE)("check_in").notNull(),checkOut:(0,a.vE)("check_out").notNull(),totalPrice:(0,i.nd)("total_price").notNull(),foodSelection:(0,l.Fx)("food_selection").default([]),status:(0,n.Qq)("status").default("confirmed")}),(0,r.cJ)("menu_items_table",{id:(0,o.vX)("id").primaryKey(),homestayId:(0,i.nd)("homestay_id").notNull().references(()=>c.id,{onDelete:"cascade"}),name:(0,n.Qq)("name").notNull(),description:(0,n.Qq)("description"),price:(0,i.nd)("price").notNull(),type:(0,n.Qq)("type").notNull()}),(0,r.cJ)("chats_table",{id:(0,o.vX)("id").primaryKey(),userId:(0,i.nd)("user_id").notNull().references(()=>u.id,{onDelete:"cascade"}),hostId:(0,i.nd)("host_id").notNull().references(()=>d.id,{onDelete:"cascade"}),messages:(0,l.Fx)("messages").notNull().default([])})}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[638,452,884],()=>s(9562));module.exports=r})();