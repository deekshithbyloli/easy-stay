(()=>{var e={};e.id=661,e.ids=[661],e.modules={5486:e=>{"use strict";e.exports=require("bcrypt")},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},5511:e=>{"use strict";e.exports=require("crypto")},9021:e=>{"use strict";e.exports=require("fs")},1645:e=>{"use strict";e.exports=require("net")},1820:e=>{"use strict";e.exports=require("os")},3873:e=>{"use strict";e.exports=require("path")},4998:e=>{"use strict";e.exports=require("perf_hooks")},7910:e=>{"use strict";e.exports=require("stream")},4631:e=>{"use strict";e.exports=require("tls")},3666:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>y,serverHooks:()=>N,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{POST:()=>m});var a=r(2706),i=r(8203),o=r(5994),n=r(9187),u=r(3345),l=r(8474),d=r(7579),c=r(5486),p=r.n(c);async function m(e){try{let{username:t,email:r,password:s,name:a,role:i}=await e.json();if(!t||!r||!s||!a)return n.NextResponse.json({error:"All fields are required"},{status:400});let o=await u.db.select().from(l.Vy).where((0,d.or)((0,d.eq)(l.Vy.username,t),(0,d.eq)(l.Vy.email,r))).limit(1).execute();if(o&&o.length>0)return n.NextResponse.json({error:"Username or email already exists"},{status:409});let c=["user","admin","host"].includes(i)?i:"user",m=await p().hash(s,10),[y]=await u.db.insert(l.Vy).values({username:t,email:r,password:m,name:a,role:c}).returning();return"host"===c&&await u.db.insert(l.GS).values({userId:y.id,propertyIds:[]}).execute(),n.NextResponse.json({message:"User registered successfully"},{status:201})}catch(e){return console.error("Registration error:",e),n.NextResponse.json({error:"Failed to register user"},{status:500})}}let y=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/register/route",pathname:"/api/register",filename:"route",bundlePath:"app/api/register/route"},resolvedPagePath:"/Users/deekshithmac/Desktop/home-stay/easy-stay/src/app/api/register/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:h,serverHooks:N}=y;function f(){return(0,o.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:h})}},6487:()=>{},8335:()=>{},3345:(e,t,r)=>{"use strict";r.d(t,{db:()=>n});var s=r(5482),a=r(6675),i=r(3186);(0,s.config)({path:".env"});let o=(0,i.A)(process.env.DATABASE_URL),n=(0,a.f)({client:o})},8474:(e,t,r)=>{"use strict";r.d(t,{GS:()=>d,Vy:()=>l,mO:()=>c});var s=r(7328),a=r(9516),i=r(4799),o=r(2590),n=r(9848),u=r(7102);let l=(0,s.cJ)("users_table",{id:(0,a.vX)("id").primaryKey(),name:(0,i.Qq)("name").notNull(),username:(0,i.Qq)("username").notNull().unique(),email:(0,i.Qq)("email").notNull().unique(),password:(0,i.Qq)("password").notNull(),role:(0,i.Qq)("role").notNull().default("user"),createdAt:(0,o.vE)("created_at").notNull().defaultNow()}),d=(0,s.cJ)("hosts_table",{id:(0,a.vX)("id").primaryKey(),userId:(0,n.nd)("user_id").notNull().references(()=>l.id,{onDelete:"cascade"}),propertyIds:(0,u.Fx)("property_ids").notNull().default([])}),c=(0,s.cJ)("homestays_table",{id:(0,a.vX)("id").primaryKey(),hostId:(0,n.nd)("host_id").notNull().references(()=>d.id,{onDelete:"cascade"}),name:(0,i.Qq)("name").notNull(),description:(0,i.Qq)("description"),photos:(0,u.Fx)("photos").notNull().default([]),location:(0,u.Fx)("location").notNull(),pricePerNight:(0,n.nd)("price_per_night").notNull(),amenities:(0,u.Fx)("amenities").notNull().default([]),rating:(0,n.nd)("rating").default(0),availability:(0,u.Fx)("availability").notNull(),createdAt:(0,o.vE)("created_at").notNull().defaultNow(),updatedAt:(0,o.vE)("updated_at").notNull().$onUpdate(()=>new Date)});(0,s.cJ)("bookings_table",{id:(0,a.vX)("id").primaryKey(),userId:(0,n.nd)("user_id").notNull().references(()=>l.id,{onDelete:"cascade"}),homestayId:(0,n.nd)("homestay_id").notNull().references(()=>c.id,{onDelete:"cascade"}),checkIn:(0,o.vE)("check_in").notNull(),checkOut:(0,o.vE)("check_out").notNull(),totalPrice:(0,n.nd)("total_price").notNull(),foodSelection:(0,u.Fx)("food_selection").default([]),status:(0,i.Qq)("status").default("confirmed")}),(0,s.cJ)("menu_items_table",{id:(0,a.vX)("id").primaryKey(),homestayId:(0,n.nd)("homestay_id").notNull().references(()=>c.id,{onDelete:"cascade"}),name:(0,i.Qq)("name").notNull(),description:(0,i.Qq)("description"),price:(0,n.nd)("price").notNull(),type:(0,i.Qq)("type").notNull()}),(0,s.cJ)("chats_table",{id:(0,a.vX)("id").primaryKey(),userId:(0,n.nd)("user_id").notNull().references(()=>l.id,{onDelete:"cascade"}),hostId:(0,n.nd)("host_id").notNull().references(()=>d.id,{onDelete:"cascade"}),messages:(0,u.Fx)("messages").notNull().default([])})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,452,884],()=>r(3666));module.exports=s})();